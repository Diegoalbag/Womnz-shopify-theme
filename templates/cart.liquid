<div id="CartPage" class="CartPage">
  <div class="CartPage-content row container-fluid">
    <div class="CartPage-content_items col-12 col-md-6 ">
      <template v-if="cart.items">
        <div v-for="(item, index) in cart.items" :key="index" class="CartItem d-flex gap-5">
          <figure class="CartItem-image my-2">
            <img :src="item.image" class="rounded-3 shadow"/>
          </figure>
          <div class="CartItem-info py-3 d-flex flex-column">
            <span>
              <h1 class="text-white fw-normal d-inline-block me-3" v-html="item.product_title"></h1>
              <span class="text-muted text-uppercase h2" v-html="item.variant_title"></span>
            </span>
            <h3 class="text-muted fw-normal" v-html="item.price"></h3>
            <div class="CartItem-info_quantity border d-flex justify-content-center align-items-center mt-5">
              <i @click="changeCart(item.variant_id, item.quantity - 1)" class="fas fa-minus fs-2 text-white"></i>
              <span class="fs-2 text-white text-center mx-5" v-html="item.quantity"></span>
              <i @click="changeCart(item.variant_id, item.quantity + 1)" class="fas fa-plus fs-2 text-white"></i>
            </div>
          </div>
        </div>
      </template>
      <template v-else>
        <h1>no items in cart</h1>
      </template>
    </div>
    <div class="CartPage-content_info col-12 col-md-6 border border-danger">
    </div>
  </div>
</div>

<script>
const { createApp, ref, computed, watch, onMounted, reactive} = Vue;

const CartPage = {
  setup() {

    let cart = ref({});

    (getCart = () => {
      axios.get('/cart.js')
      .then(response => {
        cart.value = response.data;
      });
    })();

    changeCart = (id, quantity) => {
      console.log(typeof(id), quantity)
      axios.post('/cart/update.js', 
      `updates[${id}]=${quantity}`
      )
      .then(response => {
        cart.value = response.data;
      })
      .catch(error => {
        console.log(error);
      })
    };

    return {
      cart,
      getCart,
      changeCart
    };
  }
}
createApp(CartPage).mount('#CartPage');
</script>
